---
import GameConfig from '../components/GameConfig';
import Layout from '../layouts/Layout.astro';

const lichessToken = import.meta.env.TOKEN_API_LICHESS
const apiAccountUrl = 'https://lichess.org/api/account';

let accountData = null;
let apiStatus = 'Verificando...';

try {
    const response = await fetch(apiAccountUrl, {
        method: 'GET',
        headers: {
            'Authorization': `Bearer ${lichessToken}`
        }
    });
    
    if (response.ok) {
        accountData = await response.json();
        apiStatus = `✅ ¡API FUNCIONANDO! Usuario autenticado: ${accountData.username}`;
    } else {
        const errorText = await response.text();
        apiStatus = `❌ ERROR ${response.status}: ${response.statusText}. Respuesta: ${errorText.substring(0, 100)}...`;
    }

} catch (error: any) {
    apiStatus = `❌ ERROR DE RED: ${error.message}`;
}

---

<Layout title='Ajedrez colaborativo' description='Juego de ajedrez con comandos'>
	<header class="text-center text-4xl font-bold p-2 mt-3">
		<h1>Ajedrez UCL VS Bot</h1>
	</header>
	<main>

        {apiStatus &&  (
            <GameConfig client:load />
        )}
	</main>
</Layout>
